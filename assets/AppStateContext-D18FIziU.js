import{w as y,x as b,y as p,v as w,a as c,z as S,o as E}from"./chunk-AYJ5UCUI-BvpObh6N.js";function A(t){return function(){const a={params:w(),loaderData:p(),actionData:b(),matches:y()};return c.createElement(t,a)}}function P(t){return function(){const a={params:w(),loaderData:p(),actionData:b(),error:S()};return c.createElement(t,a)}}const T="bet-tracker",x=1;function u(){return new Promise((t,e)=>{const a=indexedDB.open(T,x);a.onupgradeneeded=r=>{const o=a.result;o.objectStoreNames.contains("bets")||o.createObjectStore("bets",{keyPath:"id"}),o.objectStoreNames.contains("wallet")||o.createObjectStore("wallet",{keyPath:"id"})},a.onsuccess=()=>t(a.result),a.onerror=()=>e(a.error)})}async function d(t){const e=await u();return new Promise((a,r)=>{const s=e.transaction(t,"readonly").objectStore(t).getAll();s.onsuccess=()=>a(s.result),s.onerror=()=>r(s.error)})}async function D(t,e){const a=await u();return new Promise((r,o)=>{const l=a.transaction(t,"readwrite").objectStore(t).put(e);l.onsuccess=()=>r(),l.onerror=()=>o(l.error)})}async function g(t,e){const a=await u();return new Promise((r,o)=>{const l=a.transaction(t,"readwrite").objectStore(t).delete(e);l.onsuccess=()=>r(),l.onerror=()=>o(l.error)})}const m={bets:[],wallet:null};function h(t,e){switch(e.type){case"SET_BETS":{if(!t.wallet)return{...t,bets:e.bets};let a=t.wallet;return e.bets.forEach(r=>{const o=t.bets.find(n=>n.id===r.id);if(o){let n=a.transactions.filter(i=>i.betId!==r.id),s=a.balance;s+=o.amount,(o.outcome==="Won"||o.outcome==="Draw")&&(s-=o.payout),n=[{id:Math.random().toString(36).slice(2),type:"bet",amount:r.amount,date:r.date,betId:r.id},...n],s-=r.amount,(r.outcome==="Won"||r.outcome==="Draw")&&(n=[{id:Math.random().toString(36).slice(2),type:"payout",amount:r.payout,date:r.date,betId:r.id},...n],s+=r.payout),a={...a,balance:s,transactions:n}}}),{...t,bets:e.bets,wallet:a}}case"ADD_BET":{const a=[...t.bets,e.bet];if(!t.wallet)return{...t,bets:a};let o=[{id:Math.random().toString(36).slice(2),type:"bet",amount:e.bet.amount,date:e.bet.date,betId:e.bet.id},...t.wallet.transactions],n=t.wallet.balance-e.bet.amount;(e.bet.outcome==="Won"||e.bet.outcome==="Draw")&&(o=[{id:Math.random().toString(36).slice(2),type:"payout",amount:e.bet.payout,date:e.bet.date,betId:e.bet.id},...o],n+=e.bet.payout);const s={...t.wallet,balance:n,transactions:o};return{...t,bets:a,wallet:s}}case"DELETE_BET":{if(!t.wallet)return{...t,bets:t.bets.filter(n=>n.id!==e.id)};const a=t.bets.find(n=>n.id===e.id);if(!a)return{...t,bets:t.bets.filter(n=>n.id!==e.id)};const r=t.wallet.transactions.filter(n=>n.betId!==e.id);let o=t.wallet.balance+Number(a.amount);return(a.outcome==="Won"||a.outcome==="Draw")&&(o-=Number(a.payout)),{...t,bets:t.bets.filter(n=>n.id!==e.id),wallet:{...t.wallet,balance:o,transactions:r}}}case"SET_WALLET":case"UPDATE_WALLET":return{...t,wallet:e.wallet};case"DEPOSIT":{if(!t.wallet)return t;const a={id:Math.random().toString(36).slice(2),type:"deposit",amount:e.amount,date:new Date().toISOString()},r={...t.wallet,balance:t.wallet.balance+e.amount,transactions:[a,...t.wallet.transactions]};return{...t,wallet:r}}case"WITHDRAW":{if(!t.wallet)return t;const a={id:Math.random().toString(36).slice(2),type:"withdrawal",amount:e.amount,date:new Date().toISOString()},r={...t.wallet,balance:t.wallet.balance-e.amount,transactions:[a,...t.wallet.transactions]};return{...t,wallet:r}}default:return t}}const f=c.createContext({state:m,dispatch:()=>{}}),I=()=>c.useContext(f),L=({children:t})=>{const[e,a]=c.useReducer(h,m);return c.useEffect(()=>{(async()=>{const r=await d("bets");a({type:"SET_BETS",bets:r});const o=await d("wallet");o.length>0?a({type:"SET_WALLET",wallet:o[0]}):a({type:"SET_WALLET",wallet:{balance:0,transactions:[]}})})()},[]),c.useEffect(()=>{e.wallet&&D("wallet",{...e.wallet,id:"main"})},[e.wallet]),E.jsx(f.Provider,{value:{state:e,dispatch:a},children:t})};export{L as A,P as a,g as d,D as p,I as u,A as w};
