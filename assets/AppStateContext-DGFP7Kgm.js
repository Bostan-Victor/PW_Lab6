import{a as c,o as w}from"./chunk-D4RADZKF--V6p8_Oh.js";const m="bet-tracker",f=1;function d(){return new Promise((t,e)=>{const a=indexedDB.open(m,f);a.onupgradeneeded=o=>{const n=a.result;n.objectStoreNames.contains("bets")||n.createObjectStore("bets",{keyPath:"id"}),n.objectStoreNames.contains("wallet")||n.createObjectStore("wallet",{keyPath:"id"})},a.onsuccess=()=>t(a.result),a.onerror=()=>e(a.error)})}async function i(t){const e=await d();return new Promise((a,o)=>{const l=e.transaction(t,"readonly").objectStore(t).getAll();l.onsuccess=()=>a(l.result),l.onerror=()=>o(l.error)})}async function S(t,e){const a=await d();return new Promise((o,n)=>{const s=a.transaction(t,"readwrite").objectStore(t).put(e);s.onsuccess=()=>o(),s.onerror=()=>n(s.error)})}const b={bets:[],wallet:null};function y(t,e){switch(e.type){case"SET_BETS":{if(!t.wallet)return{...t,bets:e.bets};let a=t.wallet;return e.bets.forEach(o=>{const n=t.bets.find(r=>r.id===o.id);if(n){let r=a.transactions.filter(u=>u.betId!==o.id),l=a.balance;l+=n.amount,(n.outcome==="Won"||n.outcome==="Draw")&&(l-=n.payout),r=[{id:Math.random().toString(36).slice(2),type:"bet",amount:o.amount,date:o.date,betId:o.id},...r],l-=o.amount,(o.outcome==="Won"||o.outcome==="Draw")&&(r=[{id:Math.random().toString(36).slice(2),type:"payout",amount:o.payout,date:o.date,betId:o.id},...r],l+=o.payout),a={...a,balance:l,transactions:r}}}),{...t,bets:e.bets,wallet:a}}case"ADD_BET":{const a=[...t.bets,e.bet];if(!t.wallet)return{...t,bets:a};let n=[{id:Math.random().toString(36).slice(2),type:"bet",amount:e.bet.amount,date:e.bet.date,betId:e.bet.id},...t.wallet.transactions],r=t.wallet.balance-e.bet.amount;(e.bet.outcome==="Won"||e.bet.outcome==="Draw")&&(n=[{id:Math.random().toString(36).slice(2),type:"payout",amount:e.bet.payout,date:e.bet.date,betId:e.bet.id},...n],r+=e.bet.payout);const l={...t.wallet,balance:r,transactions:n};return{...t,bets:a,wallet:l}}case"DELETE_BET":{if(!t.wallet)return{...t,bets:t.bets.filter(r=>r.id!==e.id)};const a=t.bets.find(r=>r.id===e.id);if(!a)return{...t,bets:t.bets.filter(r=>r.id!==e.id)};const o=t.wallet.transactions.filter(r=>r.betId!==e.id);let n=t.wallet.balance+Number(a.amount);return(a.outcome==="Won"||a.outcome==="Draw")&&(n-=Number(a.payout)),{...t,bets:t.bets.filter(r=>r.id!==e.id),wallet:{...t.wallet,balance:n,transactions:o}}}case"SET_WALLET":case"UPDATE_WALLET":return{...t,wallet:e.wallet};case"DEPOSIT":{if(!t.wallet)return t;const a={id:Math.random().toString(36).slice(2),type:"deposit",amount:e.amount,date:new Date().toISOString()},o={...t.wallet,balance:t.wallet.balance+e.amount,transactions:[a,...t.wallet.transactions]};return{...t,wallet:o}}case"WITHDRAW":{if(!t.wallet)return t;const a={id:Math.random().toString(36).slice(2),type:"withdrawal",amount:e.amount,date:new Date().toISOString()},o={...t.wallet,balance:t.wallet.balance-e.amount,transactions:[a,...t.wallet.transactions]};return{...t,wallet:o}}default:return t}}const p=c.createContext({state:b,dispatch:()=>{}}),E=()=>c.useContext(p),x=({children:t})=>{const[e,a]=c.useReducer(y,b);return c.useEffect(()=>{(async()=>{const o=await i("bets");a({type:"SET_BETS",bets:o});const n=await i("wallet");n.length>0?a({type:"SET_WALLET",wallet:n[0]}):a({type:"SET_WALLET",wallet:{balance:0,transactions:[]}})})()},[]),c.useEffect(()=>{e.wallet&&S("wallet",{...e.wallet,id:"main"})},[e.wallet]),w.jsx(p.Provider,{value:{state:e,dispatch:a},children:t})};export{x as A,S as p,E as u};
